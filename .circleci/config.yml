version: 2.1



workflows:
  build:
    jobs:
      - build:
          context:
            - zilean

jobs:
  build:
    working_directory: ~/zilean/session-service
    docker:
      - image: "cimg/openjdk:11.0.13"
    steps:
      - checkout
      - setup_remote_docker
      - run: docker login --username $DOCKER_USERNAME --password $DOCKER_PASSWORD
      - run: cd session-service && docker build -t $DOCKER_USERNAME/$CIRCLE_BRANCH:latest .
      - run: docker push $DOCKER_USERNAME/$CIRCLE_BRANCH:latest
      - run: docker logout
      - run: cd session-service && mvn package -Dmaven.test.skip -f pom.xml
